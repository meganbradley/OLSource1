---
title: Statistics for Memory-Optimized Tables
ms.custom: na
ms.prod: sql-server-2016
ms.reviewer: na
ms.suite: na
ms.technology: 
  - database-engine-imoltp
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: e644766d-1d1c-43d7-83ff-8ccfe4f3af9f
---
# Statistics for Memory-Optimized Tables
  The query optimizer uses statistics about columns to create query plans that improve query performance. Statistics are collected from the tables in the database and stored in the database metadata.  
  
 Statistics are created automatically, but can also be created manually. For example, statistics are created automatically for index key columns when the index is created. For more information about creating statistics see [Statistics](../../Topics\TopicNameNotContainA/Statistics.md).  
  
 Table data typically changes over time as rows are inserted, updated, and deleted. This means statistics need to be updated periodically. By default, statistics on tables are updated automatically when the optimizer determines they might be out of date.  
  
 You have the option of updating the statistics manually any time. You can use [UPDATE STATISTICS &#40;Transact-SQL&#41;](../Topic/UPDATE%20STATISTICS%20\(Transact-SQL\).md) for individual columns, indexes, or tables. Use [sp_updatestats &#40;Transact-SQL&#41;](../Topic/sp_updatestats%20\(Transact-SQL\).md) to update statistics for all user and internal tables in the database.  
  
 Statistics can either be generated by either sampling the data or performing a fullscan. Sampled statistics only use a sample of the table data to estimate the data distribution. Fullscan statistics scan the entire table to determine the data distribution. Fullscan statistics are usually more accurate but take longer to compute. Sampled statistics can be collected faster. Sampling is the default for automatic statistics gathering.  
  
 Considerations for statistics on memory\-optimized tables:  
  
-   Starting in SQL Server 2016, statistics are automatically sampled for memory\-optimized tables.  
  
-   For natively compiled stored procedures, execution plans for queries in the procedure are optimized when the procedure is compiled. This happens only when the procedure is created and when the server restarts, not when statistics are updated. Therefore, the tables need to contain a representative set of data and statistics need to be up\-to\-date before the procedures are created.  
  
-   Natively compiled stored procedures are recompiled if the database is taken offline and brought back online, or if there is a server restart.  
  
## Guidelines for Statistics When Deploying Memory\-Optimized Tables  
 To ensure that the query optimizer has up\-to\-date statistics when creating query plans, deploy memory\-optimized tables using these five steps:  
  
1.  Create tables and indexes. Indexes are specified inline in the **CREATE TABLE** statements.  
  
2.  Load data into the tables.  
  
3.  Update statistics on the tables.  
  
4.  Create stored procedures that access the tables.  
  
5.  Run the workload, which can contain a mix of natively compiled and interpreted [!INCLUDE[tsql](../../Token\Other/tsql_md.md)] stored procedures, as well as ad hoc batches.  
  
 Creating natively compiled stored procedures after you load the data and update the statistics ensures that the optimizer has statistics available for the memory\-optimized tables. This will ensure efficient query plans when the procedure is compiled.  
  
 The following T\-SQL sample reports when the statistics on memory\-optimized tables were last updated.  
  
```tsql  
SELECT t.object_id, t.name, sp.last_updated AS 'stats_last_updated'  
FROM sys.tables t  
JOIN sys.stats s ON t.object_id=s.object_id  
CROSS APPLY sys.dm_db_stats_properties(t.object_id, s.stats_id) sp  
WHERE t.is_memory_optimized=1;  
```  
  
## See Also  
 [Memory-Optimized Tables](../../Topics\TopicNameNotContainA/Memory-Optimized-Tables.md)  
  
  